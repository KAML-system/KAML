<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø¥Ø¶Ø§ÙØ© Ø¹Ø¶Ùˆ Ù‚Ø¯ÙŠÙ… - Ø§Ù„Ø¬Ù…Ø¹ÙŠØ© Ø§Ù„ÙƒÙˆÙŠØªÙŠØ© Ù„Ù„Ù…Ø®ØªØ¨Ø±Ø§Øª Ø§Ù„Ø·Ø¨ÙŠØ©</title>
    
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-storage-compat.js"></script>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
            line-height: 1.6;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #4f46e5 0%, #7c3aed 100%);
            color: white;
            padding: 30px;
            text-align: center;
            position: relative;
        }

        .header h1 {
            font-size: 28px;
            margin-bottom: 10px;
        }

        .header p {
            font-size: 16px;
            opacity: 0.9;
        }

        .back-button {
            position: absolute;
            left: 30px;
            top: 50%;
            transform: translateY(-50%);
            background: rgba(255,255,255,0.2);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s ease;
        }

        .back-button:hover {
            background: rgba(255,255,255,0.3);
        }

        .form-container {
            padding: 40px;
        }

        .form-section {
            background: #f8fafc;
            border-radius: 12px;
            padding: 25px;
            margin-bottom: 25px;
            border: 1px solid #e2e8f0;
        }

        .section-title {
            font-size: 20px;
            font-weight: bold;
            color: #1e293b;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid #e2e8f0;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
        }

        .form-group {
            display: flex;
            flex-direction: column;
        }

        .form-label {
            font-weight: bold;
            color: #374151;
            margin-bottom: 8px;
            font-size: 14px;
        }

        .required {
            color: #ef4444;
        }

        .form-input, .form-select, .form-textarea {
            padding: 12px;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s ease;
            background: white;
        }

        .form-input:focus, .form-select:focus, .form-textarea:focus {
            outline: none;
            border-color: #3b82f6;
        }

        .editable-select {
            position: relative;
        }

        .editable-select input {
            width: 100%;
        }

        .editable-select .dropdown-list {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: white;
            border: 2px solid #e5e7eb;
            border-top: none;
            border-radius: 0 0 8px 8px;
            max-height: 200px;
            overflow-y: auto;
            z-index: 1000;
            display: none;
        }

        .editable-select .dropdown-item {
            padding: 10px 12px;
            cursor: pointer;
            border-bottom: 1px solid #f3f4f6;
        }

        .editable-select .dropdown-item:hover {
            background: #f3f4f6;
        }

        .editable-select .dropdown-item:last-child {
            border-bottom: none;
        }

        .file-upload-area {
            border: 2px dashed #d1d5db;
            border-radius: 8px;
            padding: 20px;
            text-align: center;
            background: #f9fafb;
            transition: all 0.3s ease;
            cursor: pointer;
        }

        .file-upload-area:hover {
            border-color: #3b82f6;
            background: #eff6ff;
        }

        .file-upload-area.dragover {
            border-color: #3b82f6;
            background: #eff6ff;
        }

        .file-input {
            display: none;
        }

        .file-preview {
            margin-top: 10px;
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
        }

        .file-item {
            display: flex;
            align-items: center;
            gap: 8px;
            background: #e5e7eb;
            padding: 5px 10px;
            border-radius: 6px;
            font-size: 14px;
        }

        .file-remove {
            background: #ef4444;
            color: white;
            border: none;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            cursor: pointer;
            font-size: 12px;
        }

        .submit-section {
            background: #f0f9ff;
            border: 2px solid #0ea5e9;
            border-radius: 12px;
            padding: 25px;
            text-align: center;
        }

        .submit-button {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            color: white;
            border: none;
            padding: 15px 40px;
            border-radius: 8px;
            font-size: 18px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            min-width: 200px;
        }

        .submit-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(16, 185, 129, 0.3);
        }

        .submit-button:disabled {
            background: #9ca3af;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 9999;
        }

        .loading-content {
            background: white;
            padding: 30px;
            border-radius: 12px;
            text-align: center;
        }

        .loading-spinner {
            width: 50px;
            height: 50px;
            border: 4px solid #e2e8f0;
            border-top: 4px solid #4f46e5;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        @media (max-width: 768px) {
            .container {
                margin: 10px;
                border-radius: 10px;
            }

            .form-container {
                padding: 20px;
            }

            .form-grid {
                grid-template-columns: 1fr;
            }

            .back-button {
                position: static;
                transform: none;
                margin-bottom: 15px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <button class="back-button" onclick="window.location.href='dashboard.html'">
                â† Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…
            </button>
            <h1>Ø¥Ø¶Ø§ÙØ© Ø¹Ø¶Ùˆ Ù‚Ø¯ÙŠÙ…</h1>
            <p>Ø§Ù„Ø¬Ù…Ø¹ÙŠØ© Ø§Ù„ÙƒÙˆÙŠØªÙŠØ© Ù„Ù„Ù…Ø®ØªØ¨Ø±Ø§Øª Ø§Ù„Ø·Ø¨ÙŠØ©</p>
        </div>

        <div class="form-container">
            <form id="addOldMemberForm">
                <!-- Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø´Ø®ØµÙŠØ© -->
                <div class="form-section">
                    <div class="section-title">
                        ğŸ‘¤ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø´Ø®ØµÙŠØ©
                    </div>
                    <div class="form-grid">
                        <div class="form-group">
                            <label class="form-label" for="firstNameAr">
                                Ø§Ù„Ø§Ø³Ù… Ø§Ù„Ø£ÙˆÙ„ (Ø¨Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©) <span class="required">*</span>
                            </label>
                            <input type="text" id="firstNameAr" class="form-input" required>
                        </div>
                        <div class="form-group">
                            <label class="form-label" for="middleNameAr">
                                Ø§Ù„Ø§Ø³Ù… Ø§Ù„Ø£ÙˆØ³Ø· (Ø¨Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©) <span class="required">*</span>
                            </label>
                            <input type="text" id="middleNameAr" class="form-input" required>
                        </div>
                        <div class="form-group">
                            <label class="form-label" for="lastNameAr">
                                Ø§Ù„Ø§Ø³Ù… Ø§Ù„Ø£Ø®ÙŠØ± (Ø¨Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©) <span class="required">*</span>
                            </label>
                            <input type="text" id="lastNameAr" class="form-input" required>
                        </div>
                        <div class="form-group">
                            <label class="form-label" for="firstNameEn">
                                Ø§Ù„Ø§Ø³Ù… Ø§Ù„Ø£ÙˆÙ„ (Ø¨Ø§Ù„Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠØ©) <span class="required">*</span>
                            </label>
                            <input type="text" id="firstNameEn" class="form-input" required>
                        </div>
                        <div class="form-group">
                            <label class="form-label" for="middleNameEn">
                                Ø§Ù„Ø§Ø³Ù… Ø§Ù„Ø£ÙˆØ³Ø· (Ø¨Ø§Ù„Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠØ©) <span class="required">*</span>
                            </label>
                            <input type="text" id="middleNameEn" class="form-input" required>
                        </div>
                        <div class="form-group">
                            <label class="form-label" for="lastNameEn">
                                Ø§Ù„Ø§Ø³Ù… Ø§Ù„Ø£Ø®ÙŠØ± (Ø¨Ø§Ù„Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠØ©) <span class="required">*</span>
                            </label>
                            <input type="text" id="lastNameEn" class="form-input" required>
                        </div>
                        <div class="form-group">
                            <label class="form-label" for="civilId">
                                Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ù…Ø¯Ù†ÙŠ <span class="required">*</span>
                            </label>
                            <input type="text" id="civilId" class="form-input" required>
                        </div>
                        <div class="form-group">
                            <label class="form-label" for="birthDate">
                                ØªØ§Ø±ÙŠØ® Ø§Ù„Ù…ÙŠÙ„Ø§Ø¯ <span class="required">*</span>
                            </label>
                            <input type="date" id="birthDate" class="form-input" required>
                        </div>
                        <div class="form-group">
                            <label class="form-label" for="nationality">
                                Ø§Ù„Ø¬Ù†Ø³ÙŠØ© <span class="required">*</span>
                            </label>
                            <select id="nationality" class="form-select" required>
                                <option value="">Ø§Ø®ØªØ± Ø§Ù„Ø¬Ù†Ø³ÙŠØ©</option>
                                <option value="ÙƒÙˆÙŠØªÙŠ">ÙƒÙˆÙŠØªÙŠ</option>
                                <option value="ØºÙŠØ± ÙƒÙˆÙŠØªÙŠ">ØºÙŠØ± ÙƒÙˆÙŠØªÙŠ</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label" for="gender">
                                Ø§Ù„Ø¬Ù†Ø³ <span class="required">*</span>
                            </label>
                            <select id="gender" class="form-select" required>
                                <option value="">Ø§Ø®ØªØ± Ø§Ù„Ø¬Ù†Ø³</option>
                                <option value="Ø°ÙƒØ±">Ø°ÙƒØ±</option>
                                <option value="Ø£Ù†Ø«Ù‰">Ø£Ù†Ø«Ù‰</option>
                            </select>
                        </div>
                    </div>
                </div>

                <!-- Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø§ØªØµØ§Ù„ -->
                <div class="form-section">
                    <div class="section-title">
                        ğŸ“ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø§ØªØµØ§Ù„
                    </div>
                    <div class="form-grid">
                        <div class="form-group">
                            <label class="form-label" for="email">
                                Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ <span class="required">*</span>
                            </label>
                            <input type="email" id="email" class="form-input" required>
                        </div>
                        <div class="form-group">
                            <label class="form-label" for="phone">
                                Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ <span class="required">*</span>
                            </label>
                            <input type="tel" id="phone" class="form-input" required>
                        </div>
                        <div class="form-group">
                            <label class="form-label" for="region">
                                Ø§Ù„Ù…Ù†Ø·Ù‚Ø© <span class="required">*</span>
                            </label>
                            <select id="region" class="form-select" required>
                                <option value="">Ø§Ø®ØªØ± Ø§Ù„Ù…Ù†Ø·Ù‚Ø©</option>
                                <option value="Ø§Ù„Ø¹Ø§ØµÙ…Ø©">Ø§Ù„Ø¹Ø§ØµÙ…Ø©</option>
                                <option value="Ø­ÙˆÙ„ÙŠ">Ø­ÙˆÙ„ÙŠ</option>
                                <option value="Ø§Ù„ÙØ±ÙˆØ§Ù†ÙŠØ©">Ø§Ù„ÙØ±ÙˆØ§Ù†ÙŠØ©</option>
                                <option value="Ù…Ø¨Ø§Ø±Ùƒ Ø§Ù„ÙƒØ¨ÙŠØ±">Ù…Ø¨Ø§Ø±Ùƒ Ø§Ù„ÙƒØ¨ÙŠØ±</option>
                                <option value="Ø§Ù„Ø£Ø­Ù…Ø¯ÙŠ">Ø§Ù„Ø£Ø­Ù…Ø¯ÙŠ</option>
                                <option value="Ø§Ù„Ø¬Ù‡Ø±Ø§Ø¡">Ø§Ù„Ø¬Ù‡Ø±Ø§Ø¡</option>
                            </select>
                        </div>
                    </div>
                </div>

                <!-- Ø§Ù„Ù…Ø¤Ù‡Ù„Ø§Øª Ø§Ù„Ù…Ù‡Ù†ÙŠØ© -->
                <div class="form-section">
                    <div class="section-title">
                        ğŸ“ Ø§Ù„Ù…Ø¤Ù‡Ù„Ø§Øª Ø§Ù„Ù…Ù‡Ù†ÙŠØ©
                    </div>
                    <div class="form-grid">
                        <div class="form-group">
                            <label class="form-label" for="qualification">
                                Ø§Ù„Ù…Ø¤Ù‡Ù„ Ø§Ù„Ø¹Ù„Ù…ÙŠ <span class="required">*</span>
                            </label>
                            <select id="qualification" class="form-select" required>
                                <option value="">Ø§Ø®ØªØ± Ø§Ù„Ù…Ø¤Ù‡Ù„ Ø§Ù„Ø¹Ù„Ù…ÙŠ</option>
                                <option value="Ø¯Ø¨Ù„ÙˆÙ…">Ø¯Ø¨Ù„ÙˆÙ…</option>
                                <option value="Ø¨ÙƒØ§Ù„ÙˆØ±ÙŠÙˆØ³">Ø¨ÙƒØ§Ù„ÙˆØ±ÙŠÙˆØ³</option>
                                <option value="Ù…Ø§Ø¬Ø³ØªÙŠØ±">Ù…Ø§Ø¬Ø³ØªÙŠØ±</option>
                                <option value="Ø¯ÙƒØªÙˆØ±Ø§Ù‡">Ø¯ÙƒØªÙˆØ±Ø§Ù‡</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label" for="specialization">
                                Ø§Ù„ØªØ®ØµØµ <span class="required">*</span>
                            </label>
                            <div class="editable-select">
                                <input type="text" id="specialization" class="form-input" required 
                                       placeholder="Ø§Ø®ØªØ± Ù…Ù† Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø£Ùˆ Ø§ÙƒØªØ¨ ØªØ®ØµØµÙƒ">
                                <div class="dropdown-list" id="specializationDropdown"></div>
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="form-label" for="workplace">
                                Ø¬Ù‡Ø© Ø§Ù„Ø¹Ù…Ù„ <span class="required">*</span>
                            </label>
                            <div class="editable-select">
                                <input type="text" id="workplace" class="form-input" required 
                                       placeholder="Ø§Ø®ØªØ± Ù…Ù† Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø£Ùˆ Ø§ÙƒØªØ¨ Ø¬Ù‡Ø© Ø§Ù„Ø¹Ù…Ù„">
                                <div class="dropdown-list" id="workplaceDropdown"></div>
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="form-label" for="jobTitle">
                                Ø§Ù„Ù…Ø³Ù…Ù‰ Ø§Ù„ÙˆØ¸ÙŠÙÙŠ <span class="required">*</span>
                            </label>
                            <div class="editable-select">
                                <input type="text" id="jobTitle" class="form-input" required 
                                       placeholder="Ø§Ø®ØªØ± Ù…Ù† Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø£Ùˆ Ø§ÙƒØªØ¨ Ø§Ù„Ù…Ø³Ù…Ù‰ Ø§Ù„ÙˆØ¸ÙŠÙÙŠ">
                                <div class="dropdown-list" id="jobTitleDropdown"></div>
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="form-label" for="experienceYears">
                                Ø³Ù†ÙˆØ§Øª Ø§Ù„Ø®Ø¨Ø±Ø© <span class="required">*</span>
                            </label>
                            <select id="experienceYears" class="form-select" required>
                                <option value="">Ø§Ø®ØªØ± Ø³Ù†ÙˆØ§Øª Ø§Ù„Ø®Ø¨Ø±Ø©</option>
                                <option value="Ø£Ù‚Ù„ Ù…Ù† Ø³Ù†Ø©">Ø£Ù‚Ù„ Ù…Ù† Ø³Ù†Ø©</option>
                                <option value="1-3 Ø³Ù†ÙˆØ§Øª">1-3 Ø³Ù†ÙˆØ§Øª</option>
                                <option value="4-6 Ø³Ù†ÙˆØ§Øª">4-6 Ø³Ù†ÙˆØ§Øª</option>
                                <option value="7-10 Ø³Ù†ÙˆØ§Øª">7-10 Ø³Ù†ÙˆØ§Øª</option>
                                <option value="Ø£ÙƒØ«Ø± Ù…Ù† 10 Ø³Ù†ÙˆØ§Øª">Ø£ÙƒØ«Ø± Ù…Ù† 10 Ø³Ù†ÙˆØ§Øª</option>
                            </select>
                        </div>
                    </div>
                </div>

                <!-- Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¹Ø¶ÙˆÙŠØ© -->
                <div class="form-section">
                    <div class="section-title">
                        ğŸ† Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¹Ø¶ÙˆÙŠØ©
                    </div>
                    <div class="form-grid">
                        <div class="form-group">
                            <label class="form-label" for="membershipNumber">
                                Ø±Ù‚Ù… Ø§Ù„Ø¹Ø¶ÙˆÙŠØ© <span class="required">*</span>
                            </label>
                            <input type="text" id="membershipNumber" class="form-input" required>
                        </div>
                        <div class="form-group">
                            <label class="form-label" for="membershipType">
                                Ù†ÙˆØ¹ Ø§Ù„Ø¹Ø¶ÙˆÙŠØ© <span class="required">*</span>
                            </label>
                            <select id="membershipType" class="form-select" required>
                                <option value="">Ø§Ø®ØªØ± Ù†ÙˆØ¹ Ø§Ù„Ø¹Ø¶ÙˆÙŠØ©</option>
                                <option value="Ù…Ù†ØªØ³Ø¨">Ø¹Ø¶Ùˆ Ù…Ù†ØªØ³Ø¨</option>
                                <option value="ØºÙŠØ± Ù…Ù†ØªØ³Ø¨">Ø¹Ø¶Ùˆ ØºÙŠØ± Ù…Ù†ØªØ³Ø¨</option>
                                <option value="ÙØ®Ø±ÙŠ">Ø¹Ø¶Ùˆ ÙØ®Ø±ÙŠ</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label" for="joinDate">
                                ØªØ§Ø±ÙŠØ® Ø§Ù„Ø§Ù†Ø¶Ù…Ø§Ù… <span class="required">*</span>
                            </label>
                            <input type="date" id="joinDate" class="form-input" required>
                        </div>
                        <div class="form-group">
                            <label class="form-label" for="expiryDate">
                                ØªØ§Ø±ÙŠØ® Ø§Ù†ØªÙ‡Ø§Ø¡ Ø§Ù„Ø¹Ø¶ÙˆÙŠØ© <span class="required">*</span>
                            </label>
                            <input type="date" id="expiryDate" class="form-input" required>
                        </div>
                    </div>
                </div>

                <!-- Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¯Ø®ÙˆÙ„ -->
                <div class="form-section">
                    <div class="section-title">
                        ğŸ” Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø¯Ø®ÙˆÙ„
                    </div>
                    <div class="form-grid">
                        <div class="form-group">
                            <label class="form-label" for="username">
                                Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… <span class="required">*</span>
                            </label>
                            <input type="text" id="username" class="form-input" required>
                        </div>
                        <div class="form-group">
                            <label class="form-label" for="password">
                                ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± <span class="required">*</span>
                            </label>
                            <input type="password" id="password" class="form-input" required>
                        </div>
                    </div>
                </div>

                <!-- Ø§Ù„Ù…Ø±ÙÙ‚Ø§Øª -->
                <div class="form-section">
                    <div class="section-title">
                        ğŸ“ Ø§Ù„Ù…Ø±ÙÙ‚Ø§Øª Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©
                    </div>
                    <div class="form-grid">
                        <div class="form-group">
                            <label class="form-label">ØµÙˆØ±Ø© Ø§Ù„Ø¨Ø·Ø§Ù‚Ø© Ø§Ù„Ù…Ø¯Ù†ÙŠØ© (Ø§Ù„ÙˆØ¬Ù‡ Ø§Ù„Ø£Ù…Ø§Ù…ÙŠ)</label>
                            <div class="file-upload-area" onclick="document.getElementById('civilIdFront').click()">
                                <p>ğŸ“„ Ø§Ù†Ù‚Ø± Ù„Ø±ÙØ¹ Ø§Ù„Ù…Ù„Ù Ø£Ùˆ Ø§Ø³Ø­Ø¨Ù‡ Ù‡Ù†Ø§</p>
                                <input type="file" id="civilIdFront" class="file-input" accept="image/*">
                                <div class="file-preview" id="civilIdFrontPreview"></div>
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="form-label">ØµÙˆØ±Ø© Ø§Ù„Ø¨Ø·Ø§Ù‚Ø© Ø§Ù„Ù…Ø¯Ù†ÙŠØ© (Ø§Ù„ÙˆØ¬Ù‡ Ø§Ù„Ø®Ù„ÙÙŠ)</label>
                            <div class="file-upload-area" onclick="document.getElementById('civilIdBack').click()">
                                <p>ğŸ“„ Ø§Ù†Ù‚Ø± Ù„Ø±ÙØ¹ Ø§Ù„Ù…Ù„Ù Ø£Ùˆ Ø§Ø³Ø­Ø¨Ù‡ Ù‡Ù†Ø§</p>
                                <input type="file" id="civilIdBack" class="file-input" accept="image/*">
                                <div class="file-preview" id="civilIdBackPreview"></div>
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="form-label">ØµÙˆØ±Ø© Ø§Ù„Ù…Ø¤Ù‡Ù„ Ø§Ù„Ø¹Ù„Ù…ÙŠ</label>
                            <div class="file-upload-area" onclick="document.getElementById('qualificationFile').click()">
                                <p>ğŸ“„ Ø§Ù†Ù‚Ø± Ù„Ø±ÙØ¹ Ø§Ù„Ù…Ù„Ù Ø£Ùˆ Ø§Ø³Ø­Ø¨Ù‡ Ù‡Ù†Ø§</p>
                                <input type="file" id="qualificationFile" class="file-input" accept="image/*,application/pdf">
                                <div class="file-preview" id="qualificationFilePreview"></div>
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Ø§Ù„ØµÙˆØ±Ø© Ø§Ù„Ø´Ø®ØµÙŠØ©</label>
                            <div class="file-upload-area" onclick="document.getElementById('personalPhoto').click()">
                                <p>ğŸ“„ Ø§Ù†Ù‚Ø± Ù„Ø±ÙØ¹ Ø§Ù„Ù…Ù„Ù Ø£Ùˆ Ø§Ø³Ø­Ø¨Ù‡ Ù‡Ù†Ø§</p>
                                <input type="file" id="personalPhoto" class="file-input" accept="image/*">
                                <div class="file-preview" id="personalPhotoPreview"></div>
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Ø§Ù„ØµØ­ÙŠÙØ© Ø§Ù„Ø¬Ù†Ø§Ø¦ÙŠØ©</label>
                            <div class="file-upload-area" onclick="document.getElementById('criminalRecord').click()">
                                <p>ğŸ“„ Ø§Ù†Ù‚Ø± Ù„Ø±ÙØ¹ Ø§Ù„Ù…Ù„Ù Ø£Ùˆ Ø§Ø³Ø­Ø¨Ù‡ Ù‡Ù†Ø§</p>
                                <input type="file" id="criminalRecord" class="file-input" accept="image/*,application/pdf">
                                <div class="file-preview" id="criminalRecordPreview"></div>
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="form-label">ØµÙˆØ±Ø© ØªØ±Ø®ÙŠØµ Ù…Ø²Ø§ÙˆÙ„Ø© Ø§Ù„Ù…Ù‡Ù†Ø©</label>
                            <div class="file-upload-area" onclick="document.getElementById('license').click()">
                                <p>ğŸ“„ Ø§Ù†Ù‚Ø± Ù„Ø±ÙØ¹ Ø§Ù„Ù…Ù„Ù Ø£Ùˆ Ø§Ø³Ø­Ø¨Ù‡ Ù‡Ù†Ø§</p>
                                <input type="file" id="license" class="file-input" accept="image/*,application/pdf">
                                <div class="file-preview" id="licensePreview"></div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Ø²Ø± Ø§Ù„Ø¥Ø±Ø³Ø§Ù„ -->
                <div class="submit-section">
                    <h3 style="margin-bottom: 15px;">Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø¹Ø¶Ùˆ</h3>
                    <p style="margin-bottom: 20px; color: #6b7280;">
                        ØªØ£ÙƒØ¯ Ù…Ù† ØµØ­Ø© Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø¯Ø®Ù„Ø© Ù‚Ø¨Ù„ Ø§Ù„Ø¥Ø¶Ø§ÙØ©
                    </p>
                    <button type="submit" class="submit-button" id="submitButton">
                        âœ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø¹Ø¶Ùˆ
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Loading Overlay -->
    <div class="loading-overlay" id="loadingOverlay">
        <div class="loading-content">
            <div class="loading-spinner"></div>
            <h3>Ø¬Ø§Ø±ÙŠ Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø¹Ø¶Ùˆ...</h3>
            <p>ÙŠØ±Ø¬Ù‰ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±</p>
        </div>
    </div>

    <script>
        // Firebase Configuration
        const firebaseConfig = {
            apiKey: "AIzaSyBKvr6ZI_M_s_hk3Ch2ivWBuY5jSI9QxDo",
            authDomain: "kaml-membership-system.firebaseapp.com",
            projectId: "kaml-membership-system",
            storageBucket: "kaml-membership-system.firebasestorage.app",
            messagingSenderId: "1083658943439",
            appId: "1:1083658943439:web:f6a17e3bbdb6cd8feab0ba",
            measurementId: "G-ZZSZF3X7WC"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();
        const storage = firebase.storage();

        // Dropdown data
        const specializationOptions = [
            'ØªÙ‚Ù†ÙŠØ© Ø§Ù„Ù…Ø®ØªØ¨Ø±Ø§Øª Ø§Ù„Ø·Ø¨ÙŠØ©',
            'Ø¹Ù„ÙˆÙ… Ø§Ù„Ù…Ø®ØªØ¨Ø±Ø§Øª Ø§Ù„Ø¥ÙƒÙ„ÙŠÙ†ÙŠÙƒÙŠØ©',
            'Ø§Ù„Ø£Ø­ÙŠØ§Ø¡ Ø§Ù„Ø¯Ù‚ÙŠÙ‚Ø© ÙˆØ§Ù„ÙƒÙŠÙ…ÙŠØ§Ø¡ Ø§Ù„Ø­ÙŠÙˆÙŠØ©',
            'Ø£Ù…Ø±Ø§Ø¶ Ø§Ù„Ø¯Ù… ÙˆØ§Ù„Ø£Ù†Ø³Ø¬Ø© ÙˆØ§Ù„Ø®Ù„Ø§ÙŠØ§',
            'Ø§Ù„Ù…Ù†Ø§Ø¹Ø© ÙˆØ§Ù„Ø·ÙÙŠÙ„ÙŠØ§Øª ÙˆØ§Ù„ÙˆØ±Ø§Ø«Ø© Ø§Ù„Ø·Ø¨ÙŠØ©',
            'Ø§Ù„ÙƒÙŠÙ…ÙŠØ§Ø¡ Ø§Ù„Ø­ÙŠÙˆÙŠØ© Ø§Ù„Ø·Ø¨ÙŠØ©',
            'Ø¹Ù„Ù… Ø§Ù„Ø£Ù…Ø±Ø§Ø¶',
            'Ø¹Ù„Ù… Ø§Ù„Ø£Ø­ÙŠØ§Ø¡ Ø§Ù„Ø¯Ù‚ÙŠÙ‚Ø©',
            'Ø¹Ù„Ù… Ø§Ù„Ù…Ù†Ø§Ø¹Ø©',
            'Ø¹Ù„Ù… Ø§Ù„Ø·ÙÙŠÙ„ÙŠØ§Øª',
            'Ø¹Ù„Ù… Ø§Ù„ÙˆØ±Ø§Ø«Ø© Ø§Ù„Ø·Ø¨ÙŠØ©'
        ];

        const workplaceOptions = [
            'ÙˆØ²Ø§Ø±Ø© Ø§Ù„ØµØ­Ø©',
            'ÙˆØ²Ø§Ø±Ø© Ø§Ù„Ø¯ÙØ§Ø¹',
            'ÙˆØ²Ø§Ø±Ø© Ø§Ù„Ø¯Ø§Ø®Ù„ÙŠØ©',
            'ÙˆØ²Ø§Ø±Ø© Ø§Ù„ØªØ±Ø¨ÙŠØ©',
            'ÙˆØ²Ø§Ø±Ø© Ø§Ù„ØªØ¹Ù„ÙŠÙ… Ø§Ù„Ø¹Ø§Ù„ÙŠ',
            'ÙˆØ²Ø§Ø±Ø© Ø§Ù„Ø´Ø¤ÙˆÙ† Ø§Ù„Ø§Ø¬ØªÙ…Ø§Ø¹ÙŠØ©',
            'Ø§Ù„Ù…Ø³ØªØ´ÙÙ‰ Ø§Ù„Ø£Ù…ÙŠØ±ÙŠ',
            'Ù…Ø³ØªØ´ÙÙ‰ Ù…Ø¨Ø§Ø±Ùƒ Ø§Ù„ÙƒØ¨ÙŠØ±',
            'Ù…Ø³ØªØ´ÙÙ‰ Ø§Ù„ÙØ±ÙˆØ§Ù†ÙŠØ©',
            'Ù…Ø³ØªØ´ÙÙ‰ Ø§Ù„Ø¬Ù‡Ø±Ø§Ø¡',
            'Ù…Ø³ØªØ´ÙÙ‰ Ø§Ù„Ø£Ø­Ù…Ø¯ÙŠ',
            'Ù…Ø³ØªØ´ÙÙ‰ Ø§Ù„ØµØ¨Ø§Ø­',
            'Ù…Ø³ØªØ´ÙÙ‰ Ø¯Ø³Ù…Ø§Ù† Ù„Ù…Ø±Ø¶Ù‰ Ø§Ù„Ø³ÙƒØ±ÙŠ',
            'Ù…Ø¹Ù‡Ø¯ Ø§Ù„ÙƒÙˆÙŠØª Ù„Ù„Ø£Ø¨Ø­Ø§Ø« Ø§Ù„Ø¹Ù„Ù…ÙŠØ©',
            'Ø¬Ø§Ù…Ø¹Ø© Ø§Ù„ÙƒÙˆÙŠØª',
            'Ø§Ù„Ø¬Ø§Ù…Ø¹Ø© Ø§Ù„Ø£Ù…Ø±ÙŠÙƒÙŠØ© ÙÙŠ Ø§Ù„ÙƒÙˆÙŠØª',
            'Ø¬Ø§Ù…Ø¹Ø© Ø§Ù„Ø®Ù„ÙŠØ¬ Ù„Ù„Ø¹Ù„ÙˆÙ… ÙˆØ§Ù„ØªÙƒÙ†ÙˆÙ„ÙˆØ¬ÙŠØ§',
            'Ø§Ù„Ù‚Ø·Ø§Ø¹ Ø§Ù„Ø®Ø§Øµ'
        ];

        const jobTitleOptions = [
            // ÙÙ†ÙŠÙˆ Ø§Ù„Ù…Ø®ØªØ¨Ø±Ø§Øª
            'ÙÙ†ÙŠ Ù…Ø®ØªØ¨Ø±Ø§Øª Ø£ÙˆÙ„',
            'ÙÙ†ÙŠ Ù…Ø®ØªØ¨Ø±Ø§Øª Ø«Ø§Ù†ÙŠ',
            'ÙÙ†ÙŠ Ù…Ø®ØªØ¨Ø±Ø§Øª Ø«Ø§Ù„Ø«',
            'ÙÙ†ÙŠ Ù…Ø®ØªØ¨Ø±Ø§Øª Ø±Ø§Ø¨Ø¹',
            'ÙÙ†ÙŠ Ù…Ø®ØªØ¨Ø±Ø§Øª Ø®Ø§Ù…Ø³',
            
            // Ø£Ø®ØµØ§Ø¦ÙŠÙˆ Ø§Ù„Ù…Ø®ØªØ¨Ø±Ø§Øª
            'Ø£Ø®ØµØ§Ø¦ÙŠ Ù…Ø®ØªØ¨Ø±Ø§Øª Ø£ÙˆÙ„',
            'Ø£Ø®ØµØ§Ø¦ÙŠ Ù…Ø®ØªØ¨Ø±Ø§Øª Ø«Ø§Ù†ÙŠ',
            'Ø£Ø®ØµØ§Ø¦ÙŠ Ù…Ø®ØªØ¨Ø±Ø§Øª Ø«Ø§Ù„Ø«',
            'Ø£Ø®ØµØ§Ø¦ÙŠ Ø£Ø­ÙŠØ§Ø¡ Ø¯Ù‚ÙŠÙ‚Ø©',
            'Ø£Ø®ØµØ§Ø¦ÙŠ ÙƒÙŠÙ…ÙŠØ§Ø¡ Ø­ÙŠÙˆÙŠØ©',
            'Ø£Ø®ØµØ§Ø¦ÙŠ Ø£Ù…Ø±Ø§Ø¶ Ø¯Ù…',
            'Ø£Ø®ØµØ§Ø¦ÙŠ Ù…Ù†Ø§Ø¹Ø©',
            'Ø£Ø®ØµØ§Ø¦ÙŠ Ø·ÙÙŠÙ„ÙŠØ§Øª',
            'Ø£Ø®ØµØ§Ø¦ÙŠ ÙˆØ±Ø§Ø«Ø© Ø·Ø¨ÙŠØ©',
            
            // ÙØ§ØµØ¯Ùˆ Ø§Ù„Ø¯Ù…
            'ÙØ§ØµØ¯ Ø¯Ù… Ø£ÙˆÙ„',
            'ÙØ§ØµØ¯ Ø¯Ù… Ø«Ø§Ù†ÙŠ',
            'ÙØ§ØµØ¯ Ø¯Ù… Ø«Ø§Ù„Ø«',
            'ÙØ§ØµØ¯ Ø¯Ù… Ø±Ø§Ø¨Ø¹',
            'ÙØ§ØµØ¯ Ø¯Ù… Ø®Ø§Ù…Ø³',
            'Ù…Ø´Ø±Ù ÙØ§ØµØ¯ÙŠ Ø¯Ù…',
            'Ø±Ø¦ÙŠØ³ ÙØ§ØµØ¯ÙŠ Ø¯Ù…',
            
            // Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© ÙˆØ§Ù„Ø¥Ø´Ø±Ø§Ù
            'Ù…Ø¯ÙŠØ± Ù…Ø®ØªØ¨Ø±',
            'Ù†Ø§Ø¦Ø¨ Ù…Ø¯ÙŠØ± Ù…Ø®ØªØ¨Ø±',
            'Ù…Ø´Ø±Ù Ù…Ø®ØªØ¨Ø±',
            'Ø±Ø¦ÙŠØ³ Ù‚Ø³Ù… Ø§Ù„Ù…Ø®ØªØ¨Ø±Ø§Øª',
            'Ù…Ù†Ø³Ù‚ Ù…Ø®ØªØ¨Ø±Ø§Øª',
            
            // Ø§Ù„Ø§Ø³ØªØ´Ø§Ø±ÙŠÙˆÙ† ÙˆØ§Ù„Ø£Ø·Ø¨Ø§Ø¡
            'Ø§Ø³ØªØ´Ø§Ø±ÙŠ Ø£Ù…Ø±Ø§Ø¶ Ø§Ù„Ø¯Ù…',
            'Ø§Ø³ØªØ´Ø§Ø±ÙŠ Ø§Ù„Ø£Ø­ÙŠØ§Ø¡ Ø§Ù„Ø¯Ù‚ÙŠÙ‚Ø©',
            'Ø§Ø³ØªØ´Ø§Ø±ÙŠ Ø§Ù„ÙƒÙŠÙ…ÙŠØ§Ø¡ Ø§Ù„Ø­ÙŠÙˆÙŠØ©',
            'Ø·Ø¨ÙŠØ¨ Ù…Ø®ØªØ¨Ø±Ø§Øª',
            
            // Ø§Ù„Ø£ÙƒØ§Ø¯ÙŠÙ…ÙŠÙˆÙ† ÙˆØ§Ù„Ø¨Ø§Ø­Ø«ÙˆÙ†
            'Ø£Ø³ØªØ§Ø° Ø¬Ø§Ù…Ø¹ÙŠ',
            'Ø£Ø³ØªØ§Ø° Ù…Ø´Ø§Ø±Ùƒ',
            'Ø£Ø³ØªØ§Ø° Ù…Ø³Ø§Ø¹Ø¯',
            'Ø¨Ø§Ø­Ø« Ø¹Ù„Ù…ÙŠ',
            'Ù…Ø­Ø§Ø¶Ø±',
            
            // ÙØ¦Ø§Øª Ø£Ø®Ø±Ù‰
            'Ø·Ø§Ù„Ø¨',
            'Ù…ØªÙ‚Ø§Ø¹Ø¯',
            'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'
        ];

        // Initialize editable selects
        function initializeEditableSelect(inputId, dropdownId, options) {
            const input = document.getElementById(inputId);
            const dropdown = document.getElementById(dropdownId);
            
            // Populate dropdown
            dropdown.innerHTML = options.map(option => 
                `<div class="dropdown-item" onclick="selectOption('${inputId}', '${dropdownId}', '${option}')">${option}</div>`
            ).join('');
            
            // Show/hide dropdown on focus/blur
            input.addEventListener('focus', () => {
                dropdown.style.display = 'block';
                filterOptions(inputId, dropdownId, options);
            });
            
            input.addEventListener('blur', (e) => {
                // Delay hiding to allow clicking on dropdown items
                setTimeout(() => {
                    dropdown.style.display = 'none';
                }, 200);
            });
            
            // Filter options as user types
            input.addEventListener('input', () => {
                filterOptions(inputId, dropdownId, options);
            });
        }

        function selectOption(inputId, dropdownId, value) {
            document.getElementById(inputId).value = value;
            document.getElementById(dropdownId).style.display = 'none';
        }

        function filterOptions(inputId, dropdownId, options) {
            const input = document.getElementById(inputId);
            const dropdown = document.getElementById(dropdownId);
            const query = input.value.toLowerCase();
            
            const filteredOptions = options.filter(option => 
                option.toLowerCase().includes(query)
            );
            
            dropdown.innerHTML = filteredOptions.map(option => 
                `<div class="dropdown-item" onclick="selectOption('${inputId}', '${dropdownId}', '${option}')">${option}</div>`
            ).join('');
            
            if (filteredOptions.length === 0) {
                dropdown.innerHTML = '<div class="dropdown-item" style="color: #6b7280;">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù†ØªØ§Ø¦Ø¬</div>';
            }
        }

        // File upload handling
        function setupFileUpload(inputId, previewId) {
            const input = document.getElementById(inputId);
            const preview = document.getElementById(previewId);
            
            input.addEventListener('change', function(e) {
                const file = e.target.files[0];
                if (file) {
                    showFilePreview(file, preview, inputId);
                }
            });
        }

        function showFilePreview(file, preview, inputId) {
            preview.innerHTML = `
                <div class="file-item">
                    <span>ğŸ“„ ${file.name}</span>
                    <button type="button" class="file-remove" onclick="removeFile('${inputId}', '${preview.id}')">Ã—</button>
                </div>
            `;
        }

        function removeFile(inputId, previewId) {
            document.getElementById(inputId).value = '';
            document.getElementById(previewId).innerHTML = '';
        }

        // Upload file to Firebase Storage
        async function uploadFile(file, path) {
            try {
                const storageRef = storage.ref().child(path);
                const snapshot = await storageRef.put(file);
                const downloadURL = await snapshot.ref.getDownloadURL();
                return downloadURL;
            } catch (error) {
                console.error('Error uploading file:', error);
                throw error;
            }
        }

        // Generate next membership number
        async function generateNextMembershipNumber() {
            try {
                const snapshot = await db.collection('members').get();
                const membershipNumbers = [];
                
                snapshot.forEach(doc => {
                    const data = doc.data();
                    if (data.membershipNumber) {
                        const num = parseInt(data.membershipNumber);
                        if (!isNaN(num)) {
                            membershipNumbers.push(num);
                        }
                    }
                });
                
                const nextNumber = membershipNumbers.length > 0 ? Math.max(...membershipNumbers) + 1 : 1;
                const formattedNumber = nextNumber.toString().padStart(3, '0');
                
                document.getElementById('membershipNumber').value = formattedNumber;
            } catch (error) {
                console.error('Error generating membership number:', error);
                document.getElementById('membershipNumber').value = '001';
            }
        }

        // Form submission
        document.getElementById('addOldMemberForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const submitButton = document.getElementById('submitButton');
            const loadingOverlay = document.getElementById('loadingOverlay');
            
            // Disable submit button and show loading
            submitButton.disabled = true;
            loadingOverlay.style.display = 'flex';
            
            try {
                // Collect form data
                const formData = {
                    firstNameAr: document.getElementById('firstNameAr').value.trim(),
                    middleNameAr: document.getElementById('middleNameAr').value.trim(),
                    lastNameAr: document.getElementById('lastNameAr').value.trim(),
                    firstNameEn: document.getElementById('firstNameEn').value.trim(),
                    middleNameEn: document.getElementById('middleNameEn').value.trim(),
                    lastNameEn: document.getElementById('lastNameEn').value.trim(),
                    civilId: document.getElementById('civilId').value.trim(),
                    birthDate: document.getElementById('birthDate').value,
                    nationality: document.getElementById('nationality').value,
                    gender: document.getElementById('gender').value,
                    email: document.getElementById('email').value.trim(),
                    phone: document.getElementById('phone').value.trim(),
                    region: document.getElementById('region').value,
                    qualification: document.getElementById('qualification').value,
                    specialization: document.getElementById('specialization').value.trim(),
                    workplace: document.getElementById('workplace').value.trim(),
                    jobTitle: document.getElementById('jobTitle').value.trim(),
                    experienceYears: document.getElementById('experienceYears').value,
                    membershipNumber: document.getElementById('membershipNumber').value.trim(),
                    membershipType: document.getElementById('membershipType').value,
                    joinDate: document.getElementById('joinDate').value,
                    expiryDate: document.getElementById('expiryDate').value,
                    username: document.getElementById('username').value.trim(),
                    password: document.getElementById('password').value,
                    status: 'active',
                    createdAt: new Date().toISOString(),
                    addedBy: 'admin'
                };
                
                // Upload attachments
                const attachments = [];
                const fileInputs = [
                    { id: 'civilIdFront', type: 'civil_id_front', name: 'ØµÙˆØ±Ø© Ø§Ù„Ø¨Ø·Ø§Ù‚Ø© Ø§Ù„Ù…Ø¯Ù†ÙŠØ© (Ø§Ù„ÙˆØ¬Ù‡ Ø§Ù„Ø£Ù…Ø§Ù…ÙŠ)' },
                    { id: 'civilIdBack', type: 'civil_id_back', name: 'ØµÙˆØ±Ø© Ø§Ù„Ø¨Ø·Ø§Ù‚Ø© Ø§Ù„Ù…Ø¯Ù†ÙŠØ© (Ø§Ù„ÙˆØ¬Ù‡ Ø§Ù„Ø®Ù„ÙÙŠ)' },
                    { id: 'qualificationFile', type: 'qualification', name: 'ØµÙˆØ±Ø© Ø§Ù„Ù…Ø¤Ù‡Ù„ Ø§Ù„Ø¹Ù„Ù…ÙŠ' },
                    { id: 'personalPhoto', type: 'photo', name: 'Ø§Ù„ØµÙˆØ±Ø© Ø§Ù„Ø´Ø®ØµÙŠØ©' },
                    { id: 'criminalRecord', type: 'criminal_record', name: 'Ø§Ù„ØµØ­ÙŠÙØ© Ø§Ù„Ø¬Ù†Ø§Ø¦ÙŠØ©' },
                    { id: 'license', type: 'license', name: 'ØµÙˆØ±Ø© ØªØ±Ø®ÙŠØµ Ù…Ø²Ø§ÙˆÙ„Ø© Ø§Ù„Ù…Ù‡Ù†Ø©' }
                ];
                
                for (const fileInput of fileInputs) {
                    const file = document.getElementById(fileInput.id).files[0];
                    if (file) {
                        const fileName = `members/${formData.membershipNumber}/${fileInput.type}_${Date.now()}.${file.name.split('.').pop()}`;
                        const downloadURL = await uploadFile(file, fileName);
                        attachments.push({
                            type: fileInput.type,
                            name: fileInput.name,
                            url: downloadURL,
                            fileName: file.name
                        });
                    }
                }
                
                formData.attachments = attachments;
                
                // Save to Firebase
                await db.collection('members').add(formData);
                
                // Success
                alert(`ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø¹Ø¶Ùˆ Ø¨Ù†Ø¬Ø§Ø­!\nØ±Ù‚Ù… Ø§Ù„Ø¹Ø¶ÙˆÙŠØ©: ${formData.membershipNumber}\nØ§Ù„Ø§Ø³Ù…: ${formData.firstNameAr} ${formData.middleNameAr} ${formData.lastNameAr}`);
                
                // Redirect to dashboard
                window.location.href = 'dashboard.html';
                
            } catch (error) {
                console.error('Error adding member:', error);
                alert('Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø¹Ø¶Ùˆ: ' + error.message);
            } finally {
                // Re-enable submit button and hide loading
                submitButton.disabled = false;
                loadingOverlay.style.display = 'none';
            }
        });

        // Initialize page
        document.addEventListener('DOMContentLoaded', function() {
            // Initialize editable selects
            initializeEditableSelect('specialization', 'specializationDropdown', specializationOptions);
            initializeEditableSelect('workplace', 'workplaceDropdown', workplaceOptions);
            initializeEditableSelect('jobTitle', 'jobTitleDropdown', jobTitleOptions);
            
            // Setup file uploads
            setupFileUpload('civilIdFront', 'civilIdFrontPreview');
            setupFileUpload('civilIdBack', 'civilIdBackPreview');
            setupFileUpload('qualificationFile', 'qualificationFilePreview');
            setupFileUpload('personalPhoto', 'personalPhotoPreview');
            setupFileUpload('criminalRecord', 'criminalRecordPreview');
            setupFileUpload('license', 'licensePreview');
            
            // Generate membership number
            generateNextMembershipNumber();
            
            // Set default dates
            const today = new Date().toISOString().split('T')[0];
            document.getElementById('joinDate').value = today;
            
            const nextYear = new Date();
            nextYear.setFullYear(nextYear.getFullYear() + 1);
            document.getElementById('expiryDate').value = nextYear.toISOString().split('T')[0];
        });
    </script>
</body>
</html>

